import{u as b,R as d,j as e,P as D}from"./index-COBmtdYu.js";import{M as w}from"./MailIcon-Dr6X2Fhb.js";import{A as N}from"./Avatar-BTFtifDF.js";import{E as S}from"./EmptyState-BJp8JIVm.js";import{I as U}from"./InboxIcon-CWR_-wKM.js";const C=({selectedUserId:n,onSelectUser:c,onStartNewMessage:t,isNewMessageActive:u})=>{const{state:l}=b(),f=d.useMemo(()=>{const i=new Map;l.leagues.forEach(a=>{a.members.forEach(r=>{r.id!==l.user.id&&i.set(r.id,r)})});const o={},m={};return l.directMessages.forEach(a=>{const r=a.fromUserId===l.user.id?a.toUserId:a.fromUserId;(!o[r]||a.timestamp>o[r])&&(o[r]=a.timestamp),a.toUserId===l.user.id&&!a.isRead&&(m[r]=(m[r]||0)+1)}),Array.from(i.values()).map(a=>({user:a,lastMessage:o[a.id]||0,unreadCount:m[a.id]||0})).sort((a,r)=>r.lastMessage-a.lastMessage)},[l.leagues,l.directMessages,l.user.id]);return e.jsxDEV("div",{className:"h-full flex flex-col",children:[e.jsxDEV("div",{className:"p-4 border-b border-[var(--panel-border)]",children:e.jsxDEV("button",{onClick:t,className:`w-full flex items-center justify-center gap-2 px-3 py-2 text-sm font-bold rounded-lg transition-colors ${u?"bg-cyan-500 text-black":"bg-white/10 hover:bg-white/20"}`,children:[e.jsxDEV(D,{},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/ConversationList.tsx",lineNumber:59,columnNumber:21},void 0)," New Message"]},void 0,!0,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/ConversationList.tsx",lineNumber:53,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/ConversationList.tsx",lineNumber:52,columnNumber:13},void 0),e.jsxDEV("div",{className:"flex-grow overflow-y-auto p-2 space-y-1",children:f.map(({user:i,unreadCount:o})=>e.jsxDEV("button",{onClick:()=>c(i.id),className:`w-full flex items-center justify-between p-2 rounded-md text-left transition-colors ${n===i.id?"bg-cyan-500/20":"hover:bg-white/10"}`,children:[e.jsxDEV("div",{className:"flex items-center gap-3",children:[e.jsxDEV(N,{avatar:i.avatar,className:"w-10 h-10 text-2xl rounded-full"},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/ConversationList.tsx",lineNumber:72,columnNumber:29},void 0),e.jsxDEV("span",{className:"font-semibold text-sm",children:i.name},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/ConversationList.tsx",lineNumber:73,columnNumber:29},void 0)]},void 0,!0,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/ConversationList.tsx",lineNumber:71,columnNumber:25},void 0),o>0&&e.jsxDEV("span",{className:"w-5 h-5 bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center",children:o},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/ConversationList.tsx",lineNumber:76,columnNumber:29},void 0)]},i.id,!0,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/ConversationList.tsx",lineNumber:64,columnNumber:21},void 0))},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/ConversationList.tsx",lineNumber:62,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/ConversationList.tsx",lineNumber:51,columnNumber:9},void 0)},V=({className:n})=>e.jsxDEV("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:n||"h-5 w-5",children:[e.jsxDEV("line",{x1:"22",y1:"2",x2:"11",y2:"13"},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/icons/SendIcon.tsx",lineNumber:5,columnNumber:9},void 0),e.jsxDEV("polygon",{points:"22 2 15 22 11 13 2 9 22 2"},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/icons/SendIcon.tsx",lineNumber:6,columnNumber:9},void 0)]},void 0,!0,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/icons/SendIcon.tsx",lineNumber:4,columnNumber:5},void 0),v=({userId:n,onUserSelected:c})=>{const{state:t,dispatch:u}=b(),[l,f]=d.useState(""),[i,o]=d.useState(null),m=d.useRef(null),r=(n?t.leagues.flatMap(s=>s.members).find(s=>s.id===n):null)||i;d.useEffect(()=>{n&&u({type:"MARK_CONVERSATION_AS_READ",payload:{userId:n}})},[n,u]),d.useEffect(()=>{m.current?.scrollIntoView({behavior:"smooth"})},[n,t.directMessages]);const g=()=>{!l.trim()||!r||(u({type:"SEND_DIRECT_MESSAGE",payload:{toUserId:r.id,text:l}}),f(""))},E=t.directMessages.filter(s=>s.fromUserId===t.user.id&&s.toUserId===n||s.fromUserId===n&&s.toUserId===t.user.id),p=d.useMemo(()=>{const s=new Map;return t.leagues.forEach(h=>{h.members.forEach(x=>{x.id!==t.user.id&&s.set(x.id,x)})}),Array.from(s.values())},[t.leagues,t.user.id]);return!n&&c?e.jsxDEV("div",{className:"h-full flex flex-col",children:[e.jsxDEV("div",{className:"p-2 border-b border-[var(--panel-border)]",children:e.jsxDEV("p",{className:"p-2 text-sm",children:"Select a user to start a conversation:"},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/MessageThread.tsx",lineNumber:59,columnNumber:22},void 0)},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/MessageThread.tsx",lineNumber:58,columnNumber:17},void 0),e.jsxDEV("div",{className:"flex-grow overflow-y-auto p-2 space-y-1",children:p.map(s=>e.jsxDEV("button",{onClick:()=>c(s.id),className:"w-full flex items-center p-2 rounded-md hover:bg-white/10",children:[e.jsxDEV(N,{avatar:s.avatar,className:"w-8 h-8 rounded-full mr-2"},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/MessageThread.tsx",lineNumber:64,columnNumber:29},void 0),s.name]},s.id,!0,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/MessageThread.tsx",lineNumber:63,columnNumber:25},void 0))},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/MessageThread.tsx",lineNumber:61,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/MessageThread.tsx",lineNumber:57,columnNumber:13},void 0):r?e.jsxDEV("div",{className:"h-full flex flex-col",children:[e.jsxDEV("header",{className:"p-3 border-b border-[var(--panel-border)] flex items-center gap-3",children:[e.jsxDEV(N,{avatar:r.avatar,className:"w-8 h-8 text-xl rounded-full"},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/MessageThread.tsx",lineNumber:80,columnNumber:17},void 0),e.jsxDEV("h3",{className:"font-bold text-lg",children:r.name},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/MessageThread.tsx",lineNumber:81,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/MessageThread.tsx",lineNumber:79,columnNumber:13},void 0),e.jsxDEV("main",{className:"flex-grow p-4 space-y-4 overflow-y-auto",children:[E.map(s=>e.jsxDEV("div",{className:`flex items-start gap-2.5 text-sm ${s.fromUserId===t.user.id?"justify-end":""}`,children:[s.fromUserId!==t.user.id&&e.jsxDEV(N,{avatar:r.avatar,className:"w-8 h-8 text-xl rounded-full"},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/MessageThread.tsx",lineNumber:86,columnNumber:62},void 0),e.jsxDEV("div",{className:`p-2 rounded-lg max-w-[70%] ${s.fromUserId===t.user.id?"bg-cyan-600":"bg-black/20"}`,children:e.jsxDEV("p",{children:s.text},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/MessageThread.tsx",lineNumber:88,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/MessageThread.tsx",lineNumber:87,columnNumber:25},void 0)]},s.id,!0,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/MessageThread.tsx",lineNumber:85,columnNumber:21},void 0)),e.jsxDEV("div",{ref:m},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/MessageThread.tsx",lineNumber:92,columnNumber:18},void 0)]},void 0,!0,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/MessageThread.tsx",lineNumber:83,columnNumber:13},void 0),e.jsxDEV("footer",{className:"p-3 border-t border-[var(--panel-border)]",children:e.jsxDEV("div",{className:"flex gap-2",children:[e.jsxDEV("input",{type:"text",value:l,onChange:s=>f(s.target.value),onKeyDown:s=>s.key==="Enter"&&g(),placeholder:`Message ${r.name}...`,className:"flex-grow bg-black/20 p-2 rounded-md border border-white/10 focus:outline-none focus:ring-1 focus:ring-cyan-400"},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/MessageThread.tsx",lineNumber:96,columnNumber:21},void 0),e.jsxDEV("button",{onClick:g,disabled:!l.trim(),className:"p-2 bg-cyan-500 text-black rounded-md disabled:opacity-50",children:e.jsxDEV(V,{},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/MessageThread.tsx",lineNumber:105,columnNumber:25},void 0)},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/MessageThread.tsx",lineNumber:104,columnNumber:21},void 0)]},void 0,!0,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/MessageThread.tsx",lineNumber:95,columnNumber:17},void 0)},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/MessageThread.tsx",lineNumber:94,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/MessageThread.tsx",lineNumber:78,columnNumber:9},void 0):e.jsxDEV("div",{},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/components/messages/MessageThread.tsx",lineNumber:74,columnNumber:16},void 0)},O=()=>{const{state:n,dispatch:c}=b(),[t,u]=d.useState(null),[l,f]=d.useState(!1),i=m=>{u(m),f(!1)},o=()=>{u(null),f(!0)};return d.useEffect(()=>{const m=n.directMessages.find(a=>a.toUserId===n.user.id&&!a.isRead);m&&u(m.fromUserId)},[]),e.jsxDEV("div",{className:"w-full h-full flex flex-col p-4 sm:p-6 lg:p-8 overflow-y-auto",children:[e.jsxDEV("header",{className:"flex-shrink-0 flex justify-between items-center mb-6",children:[e.jsxDEV("div",{children:e.jsxDEV("h1",{className:"font-display text-3xl sm:text-4xl font-extrabold tracking-wider uppercase flex items-center gap-3",children:[e.jsxDEV(w,{},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/views/MessagesView.tsx",lineNumber:37,columnNumber:25},void 0),"MESSAGES"]},void 0,!0,{fileName:"C:/Users/damat/_REPOS/Astral Draft/views/MessagesView.tsx",lineNumber:36,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/views/MessagesView.tsx",lineNumber:35,columnNumber:17},void 0),e.jsxDEV("button",{onClick:()=>c({type:"SET_VIEW",payload:"DASHBOARD"}),className:"px-4 py-2 bg-white/10 rounded-lg text-sm hover:bg-white/20",children:"Back to Dashboard"},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/views/MessagesView.tsx",lineNumber:41,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/damat/_REPOS/Astral Draft/views/MessagesView.tsx",lineNumber:34,columnNumber:13},void 0),e.jsxDEV("main",{className:"flex-grow glass-pane rounded-2xl overflow-hidden flex",children:[e.jsxDEV("div",{className:"w-1/3 border-r border-[var(--panel-border)] flex flex-col",children:e.jsxDEV(C,{selectedUserId:t,onSelectUser:i,onStartNewMessage:o,isNewMessageActive:l},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/views/MessagesView.tsx",lineNumber:47,columnNumber:21},void 0)},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/views/MessagesView.tsx",lineNumber:46,columnNumber:17},void 0),e.jsxDEV("div",{className:"w-2/3",children:t?e.jsxDEV(v,{userId:t},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/views/MessagesView.tsx",lineNumber:56,columnNumber:25},void 0):l?e.jsxDEV(v,{userId:null,onUserSelected:i},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/views/MessagesView.tsx",lineNumber:58,columnNumber:26},void 0):e.jsxDEV("div",{className:"h-full flex items-center justify-center",children:e.jsxDEV(S,{illustration:e.jsxDEV(U,{},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/views/MessagesView.tsx",lineNumber:62,columnNumber:47},void 0),message:"Select a conversation or start a new one."},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/views/MessagesView.tsx",lineNumber:61,columnNumber:29},void 0)},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/views/MessagesView.tsx",lineNumber:60,columnNumber:25},void 0)},void 0,!1,{fileName:"C:/Users/damat/_REPOS/Astral Draft/views/MessagesView.tsx",lineNumber:54,columnNumber:17},void 0)]},void 0,!0,{fileName:"C:/Users/damat/_REPOS/Astral Draft/views/MessagesView.tsx",lineNumber:45,columnNumber:13},void 0)]},void 0,!0,{fileName:"C:/Users/damat/_REPOS/Astral Draft/views/MessagesView.tsx",lineNumber:33,columnNumber:9},void 0)};export{O as default};
